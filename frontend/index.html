<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Farmer GPT – Frontend</title>
  <style>
    :root { --bg:#f9fafb; --card:#fff; --text:#1f2937; --muted:#6b7280; --border:#e5e7eb; --primary:#2563eb; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{background:var(--card);border-bottom:1px solid var(--border);padding:24px 16px;text-align:center}
    header h1{margin:0;font-size:28px}
    header p{margin:6px 0 0;color:var(--muted)}
    main{max-width:800px;margin:24px auto;padding:0 16px 64px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.04);margin-top:16px}
    .row{display:flex;gap:8px;margin-top:8px}
    input[type=text]{flex:1;padding:12px 14px;font-size:16px;border:1px solid var(--border);border-radius:8px;outline:none}
    input[type=text]:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.2)}
    button{padding:12px 14px;font-size:15px;border-radius:8px;border:1px solid var(--primary);background:var(--primary);color:#fff;cursor:pointer;white-space:nowrap}
    button:hover{filter:brightness(1.05)}
    #echo-output{margin-top:10px;min-height:1.5em;background:#f3f4f6;padding:8px 10px;border-radius:6px;font-family:monospace}
    footer{text-align:center;color:var(--muted);padding:24px 16px}
    code{background:#f3f4f6;padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <header>
    <h1>Farmer GPT – Frontend</h1>
    <p id="status">Connecting to backend...</p>
  </header>

  <main>
    <section class="card">
      <h2>Echo tester</h2>
      <p>Send a message to the backend and see the echoed response.</p>
      <div class="row">
        <input id="echo-input" type="text" placeholder="Type something…" />
        <button id="echo-btn">Send to <code>/api/echo</code></button>
      </div>
      <div id="echo-output">(No response)</div>
    </section>
  </main>

  <footer><small>© <span id="year"></span> Farmer GPT</small></footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // ✅ use the new backend URL
    const BACKEND_URL = "https://farmer-gpt-3.onrender.com";

    // your backend exposes /api/health
    async function checkHealth() {
      const s = document.getElementById("status");
      s.textContent = "Connecting to backend...";
      try {
        const r = await fetch(`${BACKEND_URL}/api/health`, { cache: "no-store" });
        if (!r.ok) throw new Error(r.status);
        const data = await r.json();
        s.textContent = `Backend says: ${data.status || "ok"}`;
      } catch (e) {
        s.textContent = "Backend: Offline ❌";
        console.error(e);
      }
    }

    // your backend expects { text: "..." } on /api/echo
    async function sendEcho() {
      const input = document.getElementById("echo-input");
      const out = document.getElementById("echo-output");
      const text = input.value.trim();
      if (!text) { out.textContent = "Type something first 🙂"; return; }
      out.textContent = "…sending…";
      try {
        const r = await fetch(`${BACKEND_URL}/api/echo`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text })
        });
        if (!r.ok) throw new Error(r.status);
        const data = await r.json();
        out.textContent = data.echo ?? JSON.stringify(data);
      } catch (e) {
        out.textContent = `Error: ${e}`;
        console.error(e);
      }
    }

    document.getElementById("echo-btn").addEventListener("click", (e) => {
      e.preventDefault();
      sendEcho();
    });

    checkHealth();
  </script>
</body>
</html>
